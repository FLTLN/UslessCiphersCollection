#include "tests.h"
#include "GeneratorLFSR.h"
#include <iostream>
#include <uchar.h>
#include <bitset>

static const char32_t kat[] =
    {
        1346407370,
        813954406,
        3978762132,
        1627908813,
        3662556968,
        3255817627,
        3030146641,
        2216667959,
        1765325987,
        138368622,
        3530651974,
        276737245,
        2766336652,
        553474491,
        1237706008,
        1106948982,
        2475412016,
        2213897965,
        655856737,
        132828634,
        1311713474,
        265657268,
        2623426948,
        531314537,
        951886600,
        1062629074,
        1903773200,
        2125258148,
        3807546400,
        4250516297,
        3320125505,
        4206065299,
        2345283715,
        4117163303,
        395600135,
        3939359310,
        791200271,
        3583751324,
        1582400543,
        2872535352,
        3164801087,
        1450103409,
        2034634878,
        2900206818,
        4069269757,
        1505446341,
        3843572218,
        3010892683,
        3392177141,
        1726818071,
        2489386986,
        3453636143,
        683806677,
        2612304990,
        1367613355,
        929642684,
        2735226710,
        1859285369,
        1175486124,
        3718570738,
        2350972249,
        3142174181,
        406977203,
        1989381066,
        813954406,
        3978762132,
        1627908813,
        3662556968,
        3255817627,
        3030146641,
        2216667959,
        1765325987,
        138368622,
        3530651974,
        276737245,
        2766336652,
        553474491,
        1237706008,
        1106948982,
        2475412016,
        2213897965,
        655856737,
        132828634,
        1311713474,
        265657268,
        2623426948,
        531314537,
        951886600,
        1062629074,
        1903773200,
        2125258148,
        3807546400,
        4250516297,
        3320125505,
        4206065299,
        2345283715,
        4117163303,
        395600135,
        3939359310,
        791200271};

bool t_lfsr()
{
   std::cout << "Test LFSR generator\n";

   char32_t polynomial = 0xE10000;
   char32_t seed = 0xD1020A;

   GeneratorLFSR LFSR(polynomial, 24, seed);

   bool is_passed = true;

   for (size_t i = 0; i < 100 && is_passed; i++)
   {
      is_passed = (LFSR.generate(sizeof(char32_t) * 8) == kat[i]);
   }

   return is_passed;
}
